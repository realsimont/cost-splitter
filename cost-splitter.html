<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Cost Splitter</title>

</head>

<body>
    <div class="full-page-area">
        <div class="form-area">
            <div id="add-person-div">
                <input type="button" id="add-person" value="Add Person" onclick="addPerson()">
            </div>
            <div id="person-0-div">
                <input type="text" id="name-0" placeholder="Name 1">
                <input type="text" id="amount-0" placeholder="Amount 1">
            </div>
            <div id="person-1-div">
                <input type="text" id="name-1" placeholder="Name 2">
                <input type="text" id="amount-1" placeholder="Amount 2">
            </div>
            <div id="script-added-inputs-div">
                <!-- JS will add inputs here -->
            </div>
            <div id="calculate-split-div">
                <input type="button" id="calculate-split" value="Calculate Split" onclick="getAverage(); buildSortedPeopleArray(); calculateSplit();";>
            </div>
        </div>
    </div>
    <script>
        var count = 2; // 
        function addPerson() {
            //create a name input and give it all the attributes it needs: id, text, placeholder
            //assign it the id and placeholder etc. based on the current count
            //append it to the script added inputs div
            //repeat for amount input
            let personInputDiv = document.createElement("div");
            personInputDiv.id = "person-" + count + "-div";
            personInputDiv.classList.add("person-div");
            document.getElementById("script-added-inputs-div").appendChild(personInputDiv);
            let nameInput = document.createElement("input");
            nameInput.id = "name-" + count;
            nameInput.placeholder = "Name " + (count + 1);
            personInputDiv.appendChild(nameInput);
            let amountInput = document.createElement("input");
            amountInput.id = "amount-" + count;
            amountInput.placeholder = "Amount " + (count + 1);
            personInputDiv.appendChild(amountInput);
            count++;
        }
        
        //find average of amounts
        var amounts = [];
        var avg;
        function getAverage(){
            for (i=0; i<count; i++) {
                amounts.push(document.getElementById("amount-" + i).value);
            }
            console.log(amounts);
            var total = 0;
            for (i=0; i<amounts.length; i++) {
            total += parseInt(amounts[i]);
            }
            avg = total / amounts.length;
            console.log(avg);
        }
        //build an array of person objects with name and values
        var sortedPeopleArray = [];
        function buildSortedPeopleArray() {
            for (i=0; i<count; i++) {
                let amountInput = document.getElementById("amount-" + i).value;
                let person = {
                    name: document.getElementById("name-" + i).value,
                    amountPaid: document.getElementById("amount-" + i).value,
                    isSettled: false,
                    diffFromAvg: Math.abs(avg - amountInput),
                }
                sortedPeopleArray.push(person);
            }
            sortedPeopleArray.sort((a, b) => (a.amountPaid - b.amountPaid));
            console.log(sortedPeopleArray);
        }


        function calculateSplit() {
            let top = sortedPeopleArray.length - 1;
            for (i=0; i<sortedPeopleArray.length; i++) {
                if (i >= top) {
                    break;
                } else {
                    if (sortedPeopleArray[i].diffFromAvg < sortedPeopleArray[top].diffFromAvg) {
                        console.log(`${sortedPeopleArray[i].name} pays ${sortedPeopleArray[top].name} ${sortedPeopleArray[i].diffFromAvg}`);
                        sortedPeopleArray[top].diffFromAvg -= sortedPeopleArray[i].diffFromAvg;
                        sortedPeopleArray[i].diffFromAvg = 0;
                        sortedPeopleArray[i].isSettled = true;
                    } else if (sortedPeopleArray[i].diffFromAvg > sortedPeopleArray[top].diffFromAvg) {
                        console.log(`${sortedPeopleArray[i].name} pays ${sortedPeopleArray[top].name} ${sortedPeopleArray[top].diffFromAvg}`);
                        sortedPeopleArray[i].diffFromAvg -= sortedPeopleArray[top].diffFromAvg;
                        sortedPeopleArray[top].diffFromAvg = 0;
                        sortedPeopleArray[top].isSettled = true;
                        top--;
                        i--;
                    } else if (sortedPeopleArray[i].diffFromAvg === sortedPeopleArray[top].diffFromAvg) {
                        console.log(`${sortedPeopleArray[i].name} pays ${sortedPeopleArray[top].name} ${sortedPeopleArray[i].diffFromAvg}`);
                        sortedPeopleArray[top].diffFromAvg = 0;
                        sortedPeopleArray[top].isSettled = true;
                        sortedPeopleArray[i].diffFromAvg = 0;
                        sortedPeopleArray[i].isSettled = true;
                        top--;
                    }
                }
            }
        }

    </script>
</body>
</html>